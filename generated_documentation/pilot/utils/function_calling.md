```markdown
# Technical Documentation for `function_calling.py`

## Overview

The `function_calling.py` module is part of a larger project that appears to interface with a language model (such as GPT or a similar AI model). It defines structures and functions for handling and invoking function calls within the context of generating prompts and processing responses from the language model.

## Imports

- `json`: Used for encoding and decoding JSON data.
- `re`: Regular expression module for string operations (not used in the provided code).
- `typing`: Provides type hints for function signatures and variable annotations.

## Type Definitions

### `JsonTypeBase`

A union type that represents a base JSON value, which can be a string, integer, float, boolean, `None`, list, or dictionary.

### `JsonType`

A type variable bound to `JsonTypeBase`, used for recursive type definitions in lists and dictionaries.

### `FunctionParameters`

A `TypedDict` representing the parameters of a function. It includes:
- `type`: A literal type with the value `"object"`.
- `properties`: A dictionary mapping parameter names to their JSON types.
- `required`: An optional list of strings representing the names of required parameters.

### `FunctionType`

A `TypedDict` representing a function type. It includes:
- `name`: The name of the function.
- `description`: An optional description of the function.
- `parameters`: A `FunctionParameters` object describing the function's parameters.

### `FunctionCall`

A `TypedDict` representing a function call. It includes:
- `name`: The name of the function to be called.
- `parameters`: A string representation of the parameters to be passed to the function.

### `FunctionCallSet`

A `TypedDict` representing a set of function calls. It includes:
- `definitions`: A list of `FunctionType` objects defining available functions.
- `functions`: A dictionary mapping function names to callable objects.

## Functions

### `add_function_calls_to_request`

This function adds function call definitions to a request object for the language model.

#### Parameters

- `gpt_data`: The request object to be sent to the language model.
- `function_calls`: An optional `FunctionCallSet` containing function call definitions.

#### Behavior

1. If `function_calls` is `None`, the function returns `None`.
2. It checks if the model specified in `gpt_data` is an instruct model (containing 'llama' or 'anthropic').
3. Adds the function call definitions to `gpt_data` under the key `'functions'`.
4. Initializes a `JsonPrompter` object with the `is_instruct` flag.
5. Determines if there is a single function call definition or multiple.
6. Generates a function call message with the role `'user'` and content generated by the `JsonPrompter`.
7. Appends the function call message to the `gpt_data['messages']` list.
8. Returns the function call message.

### `parse_agent_response`

This function post-processes the response from the language model.

#### Parameters

- `response`: The response from the language model.
- `function_calls`: An optional `FunctionCallSet`.

#### Returns

- The post-processed response, which may be the raw text or a JSON object if function calls are provided.

## Class `JsonPrompter`

A class for generating prompts for the language model based on function calls.

### Methods

#### `__init__`

Constructor for the `JsonPrompter` class.

##### Parameters

- `is_instruct`: A boolean indicating whether the prompter should use the instruct format.

#### `function_descriptions`

Generates descriptions for the specified functions.

##### Parameters

- `functions`: A list of `FunctionType` objects.
- `function_to_call`: The name of the function to describe.

##### Returns

- A list of strings containing the descriptions of the functions.

#### `function_parameters`

Generates a JSON schema for the parameters of the specified function.

##### Parameters

- `functions`: A list of `FunctionType` objects.
- `function_to_call`: The name of the function to get parameters for.

##### Returns

- A string representing the JSON schema of the function's parameters.

#### `function_data`

Generates the data necessary to generate arguments for the specified function.

##### Parameters

- `functions`: A list of `FunctionType` objects.
- `function_to_call`: The name of the function to get data for.

##### Returns

- A string containing the schema for the expected JSON object.

#### `function_summary`

Generates a summary for a single function.

##### Parameters

- `function`: A `FunctionType` object.

##### Returns

- A string containing the summary of the function.

#### `functions_summary`

Generates a summary of all provided functions.

##### Parameters

- `functions`: A list of `FunctionType` objects.

##### Returns

- A string containing a bulleted list of function summaries.

#### `prompt`

Generates a prompt for the language model.

##### Parameters

- `prompt`: The initial prompt text.
- `functions`: A list of `FunctionType` objects.
- `function_to_call`: Optionally, the name of a specific function to call.

##### Returns

- A string containing the generated prompt for the language model.

## Usage

The `function_calling.py` module is likely used to generate structured prompts for a language model, allowing it to execute specific functions based on user input. It also processes the model's responses to extract structured data or function results.
```